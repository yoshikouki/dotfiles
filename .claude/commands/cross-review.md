# Cross Review - Multi-AI Parallel Review

複数のAIツールを使った並列レビューで盲点を減らし、品質を向上させるワークフロー。

## コンセプト

単一のAIでは見落としがちな問題を、異なるモデル・視点からの並列レビューで検出する。

```
[対象ファイル] → [観点の特定] → [並列レビュー] → [結果統合] → [改善]
```

## 実行手順

### 1. 対象ファイルと観点の特定

対象ファイルの種類に応じてレビュー観点を決定：

| ファイル種類 | レビュー観点例 |
|------------|--------------|
| 計画書・設計書 | 実現可能性、見落とし、依存関係、リスク |
| 正規表現・フィルタ | パターンの正確性、エッジケース、パフォーマンス |
| systemd/設定ファイル | 依存関係、障害復旧、セキュリティ |
| コード | バグ、セキュリティ、パフォーマンス、可読性 |
| インフラ（Ansible等） | 冪等性、エラーハンドリング、セキュリティ |

### 2. 並列レビューの実行

**利用可能なツール（環境に応じて選択）：**

#### Codex CLI (OpenAI)
```bash
# バックグラウンドで実行
codex -a never -q "以下の[種類]をレビューしてください。[観点]の観点から問題点と改善案を指摘してください。

[対象コンテンツ]
" &
```

#### Gemini CLI (Google)
```bash
gemini -q "以下の[種類]をレビューしてください。[観点]の観点から問題点と改善案を指摘してください。

[対象コンテンツ]
" &
```

#### Claude サブエージェント
Task ツールで `subagent_type=Explore` または専門エージェントを使用。

### 3. 観点別プロンプトテンプレート

**正規表現/フィルタレビュー：**
```
以下の正規表現をレビューしてください。
1. パターンは意図通りにマッチするか
2. 見落としているケースはあるか
3. パフォーマンス上の問題はあるか
4. エッジケース（エンコード、大文字小文字等）

[正規表現]
```

**systemd サービスレビュー：**
```
以下の systemd service 設計をレビューしてください。
1. 依存関係は適切か
2. 障害時の復旧は正しく動作するか
3. リソース制限は適切か

[Unit ファイル内容]
```

**設計・計画レビュー：**
```
以下の設計/計画をレビューしてください。
1. 実現可能性に問題はないか
2. 見落としている考慮事項はあるか
3. 依存関係やリスクは識別されているか
4. より良いアプローチはあるか

[計画内容]
```

**コードレビュー：**
```
以下のコードをレビューしてください。
1. バグや論理エラーはあるか
2. セキュリティ上の問題はあるか
3. パフォーマンス上の問題はあるか
4. コードの可読性・保守性

[コード]
```

### 4. 結果の統合

各AIからのレビュー結果を統合：

1. **重複の除去**: 複数AIが指摘した同じ問題をまとめる
2. **優先度付け**: 重大度でソート（重大 > 高 > 中 > 低）
3. **検証**: 各指摘が妥当かを検討
4. **対応策の決定**: 各問題への対応を決定

### 5. 改善の適用

1. 対象ファイルを更新
2. 変更点をコミット
3. 必要に応じて再レビュー

## 実践例

### 例: fail2ban フィルタ設計のレビュー

```bash
# 1. Codex でフィルタ正規表現をレビュー
codex -a never -q "以下の fail2ban フィルター正規表現をレビュー..." &

# 2. Codex で systemd サービスをレビュー
codex -a never -q "以下の systemd service 設計をレビュー..." &

# 3. Claude サブエージェントで全体アーキテクチャをレビュー
# (Task ツールで subagent_type=Explore を使用)

# 4. 結果を待って統合
wait

# 5. 改善を適用してコミット
```

## ベストプラクティス

1. **観点を分けて並列実行**: 1つのプロンプトに詰め込まず、観点ごとに分ける
2. **具体的な質問**: 「問題はあるか」より「Xの観点でYは正しいか」
3. **コンテキストを与える**: 前提条件、制約、目的を明記
4. **バックグラウンド実行**: `&` や `run_in_background` で並列化
5. **結果の検証**: AIの指摘を鵜呑みにせず、妥当性を確認

## 注意事項

- 各AIツールの利用にはそれぞれの認証・設定が必要
- 機密情報を含むファイルは外部AIに送信しない
- レビュー結果はあくまで参考、最終判断は人間が行う
